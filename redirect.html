<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord OAuth2 Redirect</title>
</head>
<body>
    <h1>Discord OAuth2 Redirect</h1>
    <p>Redirecting...</p>
    <div id="result"></div>
    
    <script>
        // Get the URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');  // Get the authorization code from the URL

        if (code) {
            fetchDiscordData(code);
        }

        async function fetchDiscordData(code) {
            const clientId = '1303610727122075689'; // Replace with your Discord client ID
            const clientSecret = 'Vr4aEa6aE27JMMlsFQ1Ma8bInVDStsCP'; // Replace with your Discord client secret
            const redirectUri = 'https://insane-boat.info/redirect.html'; // Replace with your redirect URI

            // Exchange the authorization code for an access token
            const tokenResponse = await fetch('https://discord.com/api/oauth2/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    client_id: clientId,
                    client_secret: clientSecret,
                    code: code,
                    grant_type: 'authorization_code',
                    redirect_uri: redirectUri,
                    scope: 'email'
                })
            });

            const tokenData = await tokenResponse.json();

            if (tokenData.access_token) {
                // Use the access token to get the user's email and other information
                const userResponse = await fetch('https://discord.com/api/v10/users/@me', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${tokenData.access_token}`
                    }
                });

                const userData = await userResponse.json();

                // Show the user data and provide a link to download it as a JSON file
                const jsonBlob = new Blob([JSON.stringify(userData, null, 2)], { type: 'application/json' });
                const jsonUrl = URL.createObjectURL(jsonBlob);

                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <h2>Your Discord Data</h2>
                    <pre>${JSON.stringify(userData, null, 2)}</pre>
                    <br>
                    <a href="${jsonUrl}" download="discord_data.json">Download your JSON data</a>
                `;
            } else {
                document.getElementById('result').innerText = 'Error fetching data from Discord';
            }
        }
    </script>
</body>
</html>
