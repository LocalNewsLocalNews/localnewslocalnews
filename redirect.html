<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord OAuth2 Redirect</title>
</head>
<body>
    <h1>Processing Your Request...</h1>
    <p>If you are not redirected, please wait a moment.</p>

    <script>
        // Fetch the code from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        
        if (code) {
            // Prepare to exchange the code for an access token
            const client_id = '1303610727122075689'; // Your client ID
            const client_secret = 'Vr4aEa6aE27JMMlsFQ1Ma8bInVDStsCP'; // Your client secret
            const redirect_uri = 'https://insane-boat.info/redirect.html'; // Your redirect URI

            // Prepare the request data
            const requestData = new URLSearchParams({
                client_id: client_id,
                client_secret: client_secret,
                code: code,
                grant_type: 'authorization_code',
                redirect_uri: redirect_uri,
                scope: 'email' // Make sure email scope is requested
            });

            // Exchange the code for the access token
            fetch('https://discord.com/api/oauth2/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: requestData
            })
            .then(response => response.json())
            .then(data => {
                if (data.access_token) {
                    // Successfully received an access token, now fetch the email
                    fetch('https://discord.com/api/users/@me', {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + data.access_token
                        }
                    })
                    .then(response => response.json())
                    .then(userData => {
                        // Process the user data (email, etc.)
                        alert('Your email: ' + userData.email); // You can use this email as needed
                        console.log(userData); // For debugging, you can view the entire user data
                    })
                    .catch(error => {
                        console.error('Error fetching user data:', error);
                    });
                } else {
                    // Error in token exchange
                    alert('Error: ' + data.error_description);
                    console.error('Error exchanging code for token:', data);
                }
            })
            .catch(error => {
                console.error('Error during fetch request:', error);
            });
        } else {
            // If the code isn't available, display an error
            alert('Error: Authorization code not found.');
        }
    </script>
</body>
</html>
